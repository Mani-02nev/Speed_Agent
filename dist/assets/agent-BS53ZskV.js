import{u as w,a as S,b as f}from"./index-Bu7ro65a.js";const C=async(m,o)=>{const a=w.getState(),g=/(?:FILE|File|# File|#File):\s*([^\s\n]+\.[^\s\n]+)\s*([\s\S]*?)(?=(?:FILE|File|# File|#File):\s*[^\s\n]+\.[^\s\n]+|$)/gi;let n;const i=[];for(;(n=g.exec(o))!==null;){const s=n[1].trim();let u=n[2],e="";const t=/```(?:\w+)?\n([\s\S]*?)```/.exec(u);if(t?e=t[1].trim():e=u.replace(/^```(?:\w+)?\n?/i,"").replace(/```$/i,"").trim(),e){const l=a.files.find(d=>d.name.toLowerCase()===s.toLowerCase()),c=l?l.content.split(`
`).length:0,r=e.split(`
`).length;i.push({fileName:s,newContent:e,added:r>c?r-c:r,removed:c>r?c-r:0,isNew:!l})}}return f.getState().setPendingPatches(i),i},L=async(m,o)=>{const a=w.getState(),g=S.getState();let n=a.files.find(e=>e.name.toLowerCase()===o.fileName.toLowerCase());if(!n){const e=o.fileName.split(".").pop()||"javascript";n=await a.createFile(m,o.fileName,"",e)}g.openFile(n);const i=g.editorInstance,s=g.monacoInstance;if(i&&s){const e=s.Uri.parse(`file:///${n.name}`);let t=s.editor.getModel(e);if(t||(t=s.editor.createModel("",n.language,e)),t){i.getModel()!==t&&i.setModel(t);const l=o.newContent,c=150;for(let d=0;d<=l.length;d+=c){const p=l.slice(0,d);t.pushEditOperations([],[{range:t.getFullModelRange(),text:p}],()=>null),a.setStreamingContent(n.id,p),await new Promise(h=>setTimeout(h,16))}t.pushEditOperations([],[{range:t.getFullModelRange(),text:l}],()=>null),i.setPosition({lineNumber:1,column:1}),i.revealLine(1);const r=i.deltaDecorations([],[{range:new s.Range(1,1,t.getLineCount(),1),options:{isWholeLine:!0,className:"ai-contribution-highlight",linesDecorationsClassName:"ai-contribution-gutter"}}]);setTimeout(()=>i.deltaDecorations(r,[]),1500)}}await a.updateFile(n.id,o.newContent),await a.fetchFiles(m);const u=f.getState().pendingPatches;f.getState().setPendingPatches(u.filter(e=>e!==o))};export{L as applyPatch,C as parsePatches};
